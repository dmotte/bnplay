<!doctype html>
<html>
  <head>
    <title>BNPlay - audio tag version</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.png" />

    <style type="text/css">
      body,
      td,
      th {
        font-family: sans-serif;
      }

      body {
        background-color: #222;
        color: #ccc;
      }

      .text-center {
        text-align: center;
      }

      .btn-ctrl {
        background-color: #000;
        color: #ccc;
        border: 1px solid #888;
        padding: 20px 30px;
        font-weight: bold;
      }
      .btn-ctrl-loading {
        color: #c60;
        border: 1px solid #f80;
      }
    </style>

    <script type="text/javascript">
      // Brown Noise Player
      class BNP {
        static switchMillis = 30_000;

        static player1;
        static player2;
        static interval;

        static switchPlayer() {
          if (this.player1.paused && !this.player2.paused) {
            // Player 2 is playing. Switch to player 1
            this.player1.play();
            this.player2.pause();
            this.player2.currentTime = 0;
          } else if (!this.player1.paused && this.player2.paused) {
            // Player 1 is playing. Switch to player 2
            this.player2.play();
            this.player1.pause();
            this.player1.currentTime = 0;
          } else if (this.player1.paused && this.player2.paused) {
            // No player is playing. Start one player
            this.player1.currentTime = 0;
            this.player1.play();
          } else if (!this.player1.paused && !this.player2.paused) {
            // Both players are playing (this should never happen). Leave
            // only player 1 playing
            this.player2.pause();
            this.player2.currentTime = 0;
          }
        }

        static initialize(player1, player2) {
          this.player1 = player1;
          this.player2 = player2;
        }

        static isPlaying() {
          return !(this.player1.paused && this.player2.paused);
        }

        static play() {
          if (this.isPlaying()) return;

          this.player2.currentTime = 0;
          this.player1.play();

          this.interval = setInterval(this.switchPlayer, this.switchMillis);
        }

        static stop() {
          if (!this.isPlaying()) return;

          clearInterval(this.interval);

          this.player1.pause();
          this.player2.pause();
          this.player1.currentTime = 0;
          this.player2.currentTime = 0;
        }

        static toggle() {
          if (this.isPlaying()) this.stop();
          else this.play();
        }
      }

      class UI {
        static load() {
          BNP.initialize(
            document.getElementById("player1"),
            document.getElementById("player2"),
          );

          const btnToggle = document.getElementById("btnToggle");

          btnToggle.classList.remove("btn-ctrl-loading");
          btnToggle.removeAttribute("disabled");
          this.update();
        }

        static update() {
          const btnToggle = document.getElementById("btnToggle"),
            divStatus = document.getElementById("divStatus");

          if (BNP.isPlaying()) {
            divStatus.textContent = "Playing...";
            btnToggle.value = "STOP";
          } else {
            divStatus.textContent = "Stopped.";
            btnToggle.value = "PLAY";
          }
        }

        static toggle() {
          BNP.toggle();
          this.update();
        }
      }
    </script>
  </head>

  <body
    onload="UI.load()"
    onkeypress="if (event.key == ' ') btnToggle.click();"
  >
    <audio hidden id="player1">
      <source src="https://dmotte.github.io/bnplay/bn-sample.flac" />
      Your browser does not support the HTML5 audio element
    </audio>
    <audio hidden id="player2">
      <source src="https://dmotte.github.io/bnplay/bn-sample.flac" />
      Your browser does not support the HTML5 audio element
    </audio>

    <div class="text-center">
      <h1>Brown noise</h1>

      <p><i>Audio tag version</i></p>
      <br />
      <div id="divStatus">Please wait...</div>
      <br />
      <input
        type="button"
        id="btnToggle"
        value="Loading..."
        class="btn-ctrl btn-ctrl-loading"
        onfocus="this.blur()"
        onclick="UI.toggle()"
        disabled="disabled"
      />
    </div>
  </body>
</html>
